# 医疗病例管理系统 - 需求说明书

## 1. 项目概述

- 目标：提供一套前后端协同的医疗病例管理与智能分析工具，覆盖患者信息、病例文档、聊天咨询与 AI 辅助分析。
- 技术栈：后端 Express + Sequelize + MariaDB；前端 Vue 3 + Vite + Element Plus；AI/OCR 使用 DeepSeek 与 Coze。
- 部署形态：开发环境本地运行（后端端口 3000，前端端口 5173，前端通过 /api 代理后端）。

## 2. 角色与对象

- 用户：注册/登录的账户，持有 JWT 凭证。
- 患者：与用户关联的就诊人信息。
- 病例：患者的医疗记录，包含上传文件与 OCR 提取文本。
- 聊天记录与分析结果：基于患者上下文的对话与 AI 生成内容。

## 3. 功能需求

### 3.1 认证与安全

- 支持注册、登录、登出，JWT 认证（默认有效期 8 小时）。
- 所有 /api/auth/\* 以外的接口需携带 Authorization: Bearer <token>。
- 建议密码加密存储、令牌刷新与过期处理。

### 3.2 患者与病例管理

- 患者：增删改查，按用户隔离。
- 病例：上传（图片/PDF）、列表、详情、编辑、删除；支持文件预览与下载。
- OCR：对上传文件进行文本提取并存储。

### 3.3 聊天与 AI 能力

- 聊天接口：发送消息、查询历史记录。
- AI 分析：调用 DeepSeek 基于患者/病例上下文生成回复或分析结果。
- 历史记录：持久化聊天与分析结果，支持分页与搜索（后续增强）。

### 3.4 前端交互

- 登录/注册与路由守卫（基于 sessionStorage token）。
- 患者上下文选择（patientStore）驱动聊天与病例操作。
- 病例上传与预览（图片/PDF），OCR 文本展示。
- 聊天界面：Markdown 渲染、历史列表、错误提示。
- 响应式布局与深色主题。

## 4. 数据与接口

- 数据库：MariaDB（默认 medical_records），模型包含 User、Patient、MedicalRecord、ChatHistory、AnalysisResult。
- API 基础路径：/api；路由分层（auth、patient、medicalRecord、chat）。
- 外部服务：Coze OCR、DeepSeek AI；通过服务层封装。

## 5. 非功能需求

- 兼容性：Node.js 18+；MariaDB 10.5+。
- 性能：接口响应与文件处理需在可接受范围，后续补充基准与分页/搜索优化。
- 可靠性与监控：建议接入日志/告警；文件上传需大小/类型/速率限制与失败重试。
- 安全：输入校验、权限隔离、JWT 刷新策略（生产可选）。

## 6. 约束与假设

- 开发主要在本地环境完成；生产部署未在本文档中展开。
- 前端通过 Vite 代理访问后端；需确保后端先启动。
- 文件存储默认本地磁盘（medical-records/），可按需替换为对象存储。
